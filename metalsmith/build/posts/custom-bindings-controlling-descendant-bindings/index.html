<p><em>Note: Creating custom bindings that control descendant binding is an advanced technique, typically used only when creating libraries of reusable bindings. It&#39;s not something you&#39;ll normally need to do when building applications with Knockout.</em></p>
<p>By default, bindings only affect the element to which they are applied. But what if you want to affect all descendant elements too? This is possible. Your binding can tell Knockout <em>not</em> to bind descendants at all, and then your custom binding can do whatever it likes to bind them in a different way.</p>
<p>To do this, simply return <code>{ controlsDescendantBindings: true }</code> from your binding&#39;s <code>init</code> function.</p>
<h3 id="example-controlling-whether-or-not-descendant-bindings-are-applied">Example: Controlling whether or not descendant bindings are applied</h3>
<p>For a very simple example, here&#39;s a custom binding called <code>allowBindings</code> that allows descendant bindings to be applied only if its value is <code>true</code>. If the value is <code>false</code>, then <code>allowBindings</code> tells Knockout that it is responsible for descendant bindings so they won&#39;t be bound as usual.</p>
<pre><code class="lang-javascript">ko.bindingHandlers.allowBindings = {
    init: function(elem, valueAccessor) {
        // Let bindings proceed as normal *only if* my value is false
        var shouldAllowBindings = ko.unwrap(valueAccessor());
        return { controlsDescendantBindings: !shouldAllowBindings };
    }
};
</code></pre>
<p>To see this take effect, here&#39;s a sample usage:</p>
<pre><code class="lang-html">&lt;div data-bind=&quot;allowBindings: true&quot;&gt;
    &lt;!-- This will display Replacement, because bindings are applied --&gt;
    &lt;div data-bind=&quot;text: &#39;Replacement&#39;&quot;&gt;Original&lt;/div&gt;
&lt;/div&gt;

&lt;div data-bind=&quot;allowBindings: false&quot;&gt;
    &lt;!-- This will display Original, because bindings are not applied --&gt;
    &lt;div data-bind=&quot;text: &#39;Replacement&#39;&quot;&gt;Original&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<h3 id="example-supplying-additional-values-to-descendant-bindings">Example: Supplying additional values to descendant bindings</h3>
<p>Normally, bindings that use <code>controlsDescendantBindings</code> will also call <code>ko.applyBindingsToDescendants(someBindingContext, element)</code> to apply the descendant bindings against some modified <a href="binding-context.html">binding context</a>. For example, you could have a binding called <code>withProperties</code> that attaches some extra properties to the binding context that will then be available to all descendant bindings:</p>
<pre><code class="lang-javascript">ko.bindingHandlers.withProperties = {
    init: function(element, valueAccessor, allBindings, viewModel, bindingContext) {
        // Make a modified binding context, with a extra properties, and apply it to descendant elements
        var innerBindingContext = bindingContext.extend(valueAccessor);
        ko.applyBindingsToDescendants(innerBindingContext, element);

        // Also tell KO *not* to bind the descendants itself, otherwise they will be bound twice
        return { controlsDescendantBindings: true };
    }
};
</code></pre>
<p>As you can see, binding contexts have an <code>extend</code> function that produces a clone with extra properties. The <code>extend</code> function accepts either an object with the properties to copy or a function that returns such an object. The function syntax is preferred so that future changes in the binding value are always updated in the binding context. This process doesn&#39;t affect the original binding context, so there is no danger of affecting sibling-level elements - it will only affect descendants.</p>
<p>Here&#39;s an example of using the above custom binding:</p>
<pre><code class="lang-html">&lt;div data-bind=&quot;withProperties: { emotion: &#39;happy&#39; }&quot;&gt;
    Today I feel &lt;span data-bind=&quot;text: emotion&quot;&gt;&lt;/span&gt;. &lt;!-- Displays: happy --&gt;
&lt;/div&gt;
&lt;div data-bind=&quot;withProperties: { emotion: &#39;whimsical&#39; }&quot;&gt;
    Today I feel &lt;span data-bind=&quot;text: emotion&quot;&gt;&lt;/span&gt;. &lt;!-- Displays: whimsical --&gt;
&lt;/div&gt;
</code></pre>
<h3 id="example-adding-extra-levels-in-the-binding-context-hierarchy">Example: Adding extra levels in the binding context hierarchy</h3>
<p>Bindings such as <a href="#with-binding"><code>with</code></a> and <a href="#foreach-binding"><code>foreach</code></a> create extra levels in the binding context hierarchy. This means that their descendants can access data at outer levels by using <code>$parent</code>, <code>$parents</code>, <code>$root</code>, or <code>$parentContext</code>.</p>
<p>If you want to do this in custom bindings, then instead of using <code>bindingContext.extend()</code>, use <code>bindingContext.createChildContext(someData)</code>. This returns a new binding context whose viewmodel is <code>someData</code> and whose <code>$parentContext</code> is <code>bindingContext</code>. If you want, you can then extend the child context with extra properties using <code>ko.utils.extend</code>. For example,</p>
<pre><code class="lang-javascript">ko.bindingHandlers.withProperties = {
    init: function(element, valueAccessor, allBindings, viewModel, bindingContext) {
        // Make a modified binding context, with a extra properties, and apply it to descendant elements
        var childBindingContext = bindingContext.createChildContext(
            bindingContext.$rawData,
            null, // Optionally, pass a string here as an alias for the data item in descendant contexts
            function(context) {
                ko.utils.extend(context, valueAccessor());
            });
        ko.applyBindingsToDescendants(childBindingContext, element);

        // Also tell KO *not* to bind the descendants itself, otherwise they will be bound twice
        return { controlsDescendantBindings: true };
    }
};
</code></pre>
<p>This updated <code>withProperties</code> binding could now be used in a nested way, with each level of nesting able to access the parent level via <code>$parentContext</code>:</p>
<pre><code class="lang-html">&lt;div data-bind=&quot;withProperties: { displayMode: &#39;twoColumn&#39; }&quot;&gt;
    The outer display mode is &lt;span data-bind=&quot;text: displayMode&quot;&gt;&lt;/span&gt;.
    &lt;div data-bind=&quot;withProperties: { displayMode: &#39;doubleWidth&#39; }&quot;&gt;
        The inner display mode is &lt;span data-bind=&quot;text: displayMode&quot;&gt;&lt;/span&gt;, but I haven&#39;t forgotten
        that the outer display mode is &lt;span data-bind=&quot;text: $parentContext.displayMode&quot;&gt;&lt;/span&gt;.
    &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p>By modifying binding contexts and controlling descendant bindings, you have a powerful and advanced tool to create custom binding mechanisms of your own.</p>
