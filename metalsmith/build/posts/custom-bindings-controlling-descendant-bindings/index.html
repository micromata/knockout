<p><em>Note: Creating custom bindings that control descendant binding is an advanced technique, typically used only when creating libraries of reusable bindings. It's not something you'll normally need to do when building applications with Knockout.</em></p>
<p>By default, bindings only affect the element to which they are applied. But what if you want to affect all descendant elements too? This is possible. Your binding can tell Knockout <em>not</em> to bind descendants at all, and then your custom binding can do whatever it likes to bind them in a different way.</p>
<p>To do this, simply return <code class="lang-css"><span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">controlsDescendantBindings</span>:<span class="hljs-value"> true </span></span></span>}</code> from your binding's <code class="lang-swift"><span class="hljs-keyword">init</span></code> function.</p>
<h3 id="example-controlling-whether-or-not-descendant-bindings-are-applied">Example: Controlling whether or not descendant bindings are applied</h3>
<p>For a very simple example, here's a custom binding called <code>allowBindings</code> that allows descendant bindings to be applied only if its value is <code class="lang-actionscript"><span class="hljs-literal">true</span></code>. If the value is <code class="lang-actionscript"><span class="hljs-literal">false</span></code>, then <code>allowBindings</code> tells Knockout that it is responsible for descendant bindings so they won't be bound as usual.</p>
<pre><code class="lang-javascript">ko.bindingHandlers.allowBindings = {
    init: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">elem, valueAccessor</span>) </span>{
        <span class="hljs-comment">// Let bindings proceed as normal *only if* my value is false</span>
        <span class="hljs-keyword">var</span> shouldAllowBindings = ko.unwrap(valueAccessor());
        <span class="hljs-keyword">return</span> { controlsDescendantBindings: !shouldAllowBindings };
    }
};
</code></pre>
<p>To see this take effect, here's a sample usage:</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"allowBindings: true"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- This will display Replacement, because bindings are applied --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"text: 'Replacement'"</span>&gt;</span>Original<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"allowBindings: false"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- This will display Original, because bindings are not applied --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"text: 'Replacement'"</span>&gt;</span>Original<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre>
<h3 id="example-supplying-additional-values-to-descendant-bindings">Example: Supplying additional values to descendant bindings</h3>
<p>Normally, bindings that use <code>controlsDescendantBindings</code> will also call <code class="lang-stylus">ko.<span class="hljs-function"><span class="hljs-title">applyBindingsToDescendants</span><span class="hljs-params">(someBindingContext, element)</span></span></code> to apply the descendant bindings against some modified <a href="binding-context.html">binding context</a>. For example, you could have a binding called <code>withProperties</code> that attaches some extra properties to the binding context that will then be available to all descendant bindings:</p>
<pre><code class="lang-javascript">ko.bindingHandlers.withProperties = {
    init: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">element, valueAccessor, allBindings, viewModel, bindingContext</span>) </span>{
        <span class="hljs-comment">// Make a modified binding context, with a extra properties, and apply it to descendant elements</span>
        <span class="hljs-keyword">var</span> innerBindingContext = bindingContext.extend(valueAccessor);
        ko.applyBindingsToDescendants(innerBindingContext, element);

        <span class="hljs-comment">// Also tell KO *not* to bind the descendants itself, otherwise they will be bound twice</span>
        <span class="hljs-keyword">return</span> { controlsDescendantBindings: <span class="hljs-literal">true</span> };
    }
};
</code></pre>
<p>As you can see, binding contexts have an <code class="lang-crystal"><span class="hljs-keyword">extend</span></code> function that produces a clone with extra properties. The <code class="lang-crystal"><span class="hljs-keyword">extend</span></code> function accepts either an object with the properties to copy or a function that returns such an object. The function syntax is preferred so that future changes in the binding value are always updated in the binding context. This process doesn't affect the original binding context, so there is no danger of affecting sibling-level elements - it will only affect descendants.</p>
<p>Here's an example of using the above custom binding:</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"withProperties: { emotion: 'happy' }"</span>&gt;</span>
    Today I feel <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"text: emotion"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>. <span class="hljs-comment">&lt;!-- Displays: happy --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"withProperties: { emotion: 'whimsical' }"</span>&gt;</span>
    Today I feel <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"text: emotion"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>. <span class="hljs-comment">&lt;!-- Displays: whimsical --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre>
<h3 id="example-adding-extra-levels-in-the-binding-context-hierarchy">Example: Adding extra levels in the binding context hierarchy</h3>
<p>Bindings such as <a href="#with-binding"><code class="lang-actionscript"><span class="hljs-keyword">with</span></code></a> and <a href="#foreach-binding"><code class="lang-cmake"><span class="hljs-keyword">foreach</span></code></a> create extra levels in the binding context hierarchy. This means that their descendants can access data at outer levels by using <code class="lang-xquery"><span class="hljs-variable">$parent</span></code>, <code class="lang-xquery"><span class="hljs-variable">$parents</span></code>, <code class="lang-xquery"><span class="hljs-variable">$root</span></code>, or <code class="lang-xquery"><span class="hljs-variable">$parentContext</span></code>.</p>
<p>If you want to do this in custom bindings, then instead of using <code class="lang-stylus">bindingContext.<span class="hljs-function"><span class="hljs-title">extend</span><span class="hljs-params">()</span></span></code>, use <code class="lang-stylus">bindingContext.<span class="hljs-function"><span class="hljs-title">createChildContext</span><span class="hljs-params">(someData)</span></span></code>. This returns a new binding context whose viewmodel is <code>someData</code> and whose <code class="lang-xquery"><span class="hljs-variable">$parentContext</span></code> is <code>bindingContext</code>. If you want, you can then extend the child context with extra properties using <code class="lang-stylus">ko<span class="hljs-class">.utils</span><span class="hljs-class">.extend</span></code>. For example,</p>
<pre><code class="lang-javascript">ko.bindingHandlers.withProperties = {
    init: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">element, valueAccessor, allBindings, viewModel, bindingContext</span>) </span>{
        <span class="hljs-comment">// Make a modified binding context, with a extra properties, and apply it to descendant elements</span>
        <span class="hljs-keyword">var</span> childBindingContext = bindingContext.createChildContext(
            bindingContext.$rawData,
            <span class="hljs-literal">null</span>, <span class="hljs-comment">// Optionally, pass a string here as an alias for the data item in descendant contexts</span>
            <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>) </span>{
                ko.utils.extend(context, valueAccessor());
            });
        ko.applyBindingsToDescendants(childBindingContext, element);

        <span class="hljs-comment">// Also tell KO *not* to bind the descendants itself, otherwise they will be bound twice</span>
        <span class="hljs-keyword">return</span> { controlsDescendantBindings: <span class="hljs-literal">true</span> };
    }
};
</code></pre>
<p>This updated <code>withProperties</code> binding could now be used in a nested way, with each level of nesting able to access the parent level via <code class="lang-xquery"><span class="hljs-variable">$parentContext</span></code>:</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"withProperties: { displayMode: 'twoColumn' }"</span>&gt;</span>
    The outer display mode is <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"text: displayMode"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>.
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"withProperties: { displayMode: 'doubleWidth' }"</span>&gt;</span>
        The inner display mode is <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"text: displayMode"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>, but I haven't forgotten
        that the outer display mode is <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"text: $parentContext.displayMode"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>.
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre>
<p>By modifying binding contexts and controlling descendant bindings, you have a powerful and advanced tool to create custom binding mechanisms of your own.</p>
